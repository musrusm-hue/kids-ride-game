<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kids Ride: World Tour EXTREME</title>
    <style>
        :root {
            --sky: #7ad8d0;
            --road: #95a5a6;
            --pink: #ff9ecd;
            --yellow: #ffdf6b;
            --white: #ffffff;
            --font: 'Comic Sans MS', 'Chalkboard SE', cursive;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: var(--font);
            background: var(--sky);
            overflow: hidden;
            height: 100vh;
            height: 100dvh;
            position: fixed;
            width: 100%;
            touch-action: none;
        }

        #game-stage {
            position: relative;
            width: 100%;
            height: 100%;
            background: var(--sky);
            overflow: hidden;
            transition: background 3s ease;
        }

        /* –ü–ê–†–ê–õ–õ–ê–ö–° –û–ë–õ–ê–ö–ê */
        .cloud {
            position: absolute;
            font-size: 5rem;
            opacity: 0.6;
            z-index: 5;
            pointer-events: none;
        }

        /* –î–ï–ö–û–†–ê–¶–ò–ò –ü–û –ë–û–ö–ê–ú */
        .scenery {
            position: absolute;
            font-size: 4rem;
            z-index: 10;
            pointer-events: none;
            transition: transform 0.5s;
        }

        @keyframes shake {
            0% {
                transform: translate(1px, 1px) rotate(0deg);
            }

            10% {
                transform: translate(-1px, -2px) rotate(-1deg);
            }

            20% {
                transform: translate(-3px, 0px) rotate(1deg);
            }

            30% {
                transform: translate(3px, 2px) rotate(0deg);
            }

            40% {
                transform: translate(1px, -1px) rotate(1deg);
            }

            50% {
                transform: translate(-1px, 2px) rotate(-1deg);
            }

            60% {
                transform: translate(-3px, 1px) rotate(0deg);
            }

            70% {
                transform: translate(3px, 1px) rotate(-1deg);
            }

            80% {
                transform: translate(-1px, -1px) rotate(1deg);
            }

            90% {
                transform: translate(1px, 2px) rotate(0deg);
            }

            100% {
                transform: translate(1px, -2px) rotate(-1deg);
            }
        }

        .shake {
            animation: shake 0.5s;
        }

        #road {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 100%;
            background: var(--road);
            border-left: 8px solid var(--white);
            border-right: 8px solid var(--white);
            z-index: 20;
        }

        #road::after {
            content: '';
            position: absolute;
            left: 50%;
            width: 6px;
            height: 100%;
            background: repeating-linear-gradient(0deg, #fff, #fff 50px, transparent 50px, transparent 100px);
            animation: road-flow 0.6s linear infinite;
        }

        @keyframes road-flow {
            from {
                transform: translateY(0);
            }

            to {
                transform: translateY(100px);
            }
        }

        #player {
            position: absolute;
            bottom: 15%;
            left: 50%;
            width: 90px;
            height: 130px;
            background: var(--pink);
            border-radius: 25px;
            transform: translateX(-50%);
            z-index: 100;
            box-shadow: 0 10px 0 #cc7eab, 0 20px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding-top: 15px;
            will-change: left;
        }

        #player.shielded {
            outline: 6px solid #3498db;
            outline-offset: 4px;
            box-shadow: 0 0 40px #3498db;
        }

        #player.fever {
            animation: fever-rainbow 0.5s linear infinite;
        }

        @keyframes fever-rainbow {
            0% {
                filter: hue-rotate(0deg) brightness(1.2);
            }

            100% {
                filter: hue-rotate(360deg) brightness(1.2);
            }
        }

        #player-window {
            width: 70px;
            height: 70px;
            background: #eee;
            border: 6px solid var(--white);
            border-radius: 50%;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
        }

        #player-window img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #player::after,
        #player::before {
            content: '';
            position: absolute;
            bottom: -5px;
            width: 15px;
            height: 15px;
            background: var(--yellow);
            border-radius: 50%;
            box-shadow: 0 0 15px var(--yellow);
        }

        #player::after {
            left: 10px;
        }

        #player::before {
            right: 10px;
        }

        .game-object {
            position: absolute;
            font-size: 3rem;
            transform: translate(-50%, -50%);
            z-index: 50;
            filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.2));
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            pointer-events: none;
            z-index: 200;
        }

        #hud {
            position: fixed;
            top: 20px;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 10px;
            z-index: 1000;
        }

        .hud-item {
            background: var(--white);
            padding: 8px 12px;
            border-radius: 30px;
            font-weight: 900;
            font-size: 1rem;
            box-shadow: 0 4px 0 rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 5px;
            color: #ff6b81;
        }

        #sound-btn {
            background: #fff;
            cursor: pointer;
            border: none;
        }

        #combo-tag {
            position: absolute;
            top: -45px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            font-weight: 900;
            color: #f1c40f;
            text-shadow: 0 2px 0 #000;
            display: none;
            white-space: nowrap;
        }

        #energy-bar {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 25px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 20px;
            border: 4px solid var(--white);
            overflow: hidden;
            z-index: 1000;
        }

        #energy-fill {
            width: 100%;
            height: 100%;
            background: #2ecc71;
            transition: width 0.3s, background 0.5s;
        }

        .flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.1s;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--sky);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            text-align: center;
        }

        .btn-big {
            padding: 20px 50px;
            background: #ff4757;
            color: #fff;
            border: none;
            border-radius: 50px;
            font-size: 2rem;
            font-weight: 900;
            box-shadow: 0 10px 0 #cc3a47;
            cursor: pointer;
            margin-top: 30px;
        }

        .btn-big:active {
            transform: translateY(5px);
            box-shadow: 0 5px 0 #cc3a47;
        }
    </style>
</head>

<body>
    <div id="hud">
        <div class="hud-item">‚≠ê <span id="val-score">0</span></div>
        <div class="hud-item">üç≠ <span id="val-energy">100</span></div>
        <div class="hud-item">üöÄ x<span id="val-speed">1.0</span></div>
        <button id="sound-btn" class="hud-item" onclick="toggleSound()">üîâ</button>
    </div>

    <div id="game-stage">
        <!-- –î–µ–∫–æ—Ä–∞—Ü–∏–∏ –±—É–¥—É—Ç —Å–ø–∞–≤–Ω–∏—Ç—å—Å—è –∑–¥–µ—Å—å -->
        <div id="road"></div>
        <div id="player">
            <div id="combo-tag">COMBO x2!</div>
            <div id="player-window">
                <img src="–¥–µ—Ç–∏.jpeg" alt="–î–µ—Ç–∏">
            </div>
            <div style="font-size: 0.8rem; font-weight: bold; color: white; margin-top: 2px;">VROOM!</div>
        </div>
    </div>

    <div id="energy-bar">
        <div id="energy-fill"></div>
    </div>

    <div id="start-overlay" class="overlay">
        <h1 style="font-size: 3rem; color: #fff; text-shadow: 0 5px 0 rgba(0,0,0,0.1);">WORLD TOUR EXTREME! üåç</h1>
        <img src="–¥–µ—Ç–∏.jpeg"
            style="width: 150px; height: 150px; border-radius: 50%; border: 8px solid #fff; box-shadow: 0 10px 20px rgba(0,0,0,0.2);">
        <p style="color: #fff; font-size: 1.5rem; margin-top: 20px;">
            –ü—É—Ç–µ—à–µ—Å—Ç–≤—É–π –ø–æ –º–∏—Ä–∞–º! üèúÔ∏èüèôÔ∏èüå≤<br>
            –°–æ–±–∏—Ä–∞–π –∫–æ–º–±–æ –¥–ª—è FEVER! ‚ú®<br>
            –°–∞–º–∞—è –∫—Ä–∞—Å–æ—á–Ω–∞—è –ø–æ–µ–∑–¥–∫–∞! üåà
        </p>
        <button class="btn-big" onclick="startGame()">–ì–û–ù–ö–ê! üèÅ</button>
    </div>

    <div id="flash-screen" class="flash"></div>

    <script>
        // --- AUDIO ENGINE ---
        const AudioEngine = {
            ctx: null, master: null, soundOn: true, engineOsc: null, engineGain: null, musicTimer: null,
            init() {
                if (this.ctx) return;
                this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                this.master = this.ctx.createGain();
                this.master.connect(this.ctx.destination);
                this.master.gain.value = 0.5;
            },
            playSFX(freq, type = 'sine', duration = 0.1, slide = 0) {
                if (!this.soundOn || !this.ctx) return;
                const osc = this.ctx.createOscillator();
                const g = this.ctx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                if (slide) osc.frequency.exponentialRampToValueAtTime(slide, this.ctx.currentTime + duration);
                g.gain.setValueAtTime(0.3, this.ctx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + duration);
                osc.connect(g); g.connect(this.master);
                osc.start(); osc.stop(this.ctx.currentTime + duration);
            },
            playCrash() {
                if (!this.soundOn || !this.ctx) return;
                const bufferSize = this.ctx.sampleRate * 0.2;
                const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) data[i] = Math.random() * 2 - 1;
                const noise = this.ctx.createBufferSource();
                noise.buffer = buffer;
                const filter = this.ctx.createBiquadFilter();
                filter.type = 'lowpass'; filter.frequency.value = 400;
                noise.connect(filter); filter.connect(this.master);
                noise.start();
            },
            startEngine() {
                if (!this.soundOn || !this.ctx || this.engineOsc) return;
                this.engineOsc = this.ctx.createOscillator();
                this.engineOsc.type = 'triangle';
                this.engineGain = this.ctx.createGain();
                this.engineGain.gain.value = 0.05;
                this.engineOsc.connect(this.engineGain); this.engineGain.connect(this.master);
                this.engineOsc.start();
            },
            updateEngine(speedMult) { if (this.engineOsc) this.engineOsc.frequency.setTargetAtTime(40 + (speedMult * 20), this.ctx.currentTime, 0.1); },
            stopEngine() { if (this.engineOsc) { this.engineOsc.stop(); this.engineOsc = null; } },
            playMusicStep() {
                const fever = state.combo >= 10;
                const notes = fever ? [392.00, 440.00, 493.88, 523.25] : [261.63, 293.66, 329.63, 349.23, 392.00, 440.00];
                const note = notes[Math.floor(Math.random() * notes.length)];
                this.playSFX(note, fever ? 'sawtooth' : 'square', fever ? 0.1 : 0.15, note / (fever ? 1.2 : 2));
            }
        };

        function toggleSound() {
            AudioEngine.init();
            AudioEngine.soundOn = !AudioEngine.soundOn;
            document.getElementById('sound-btn').textContent = AudioEngine.soundOn ? 'üîâ' : 'üîá';
            if (AudioEngine.soundOn && state.active) {
                AudioEngine.startEngine();
                if (!AudioEngine.musicTimer) AudioEngine.musicTimer = setInterval(() => AudioEngine.playMusicStep(), 200);
            } else {
                AudioEngine.stopEngine();
                clearInterval(AudioEngine.musicTimer); AudioEngine.musicTimer = null;
            }
        }

        // --- GAME LOGIC ---
        let state = {
            active: false, score: 0, energy: 100, baseSpeed: 6, speedMult: 1, playerX: 50,
            distance: 0, combo: 0, shield: false, magnet: 0, biome: 'forest'
        };

        const el = {
            stage: document.getElementById('game-stage'), player: document.getElementById('player'),
            score: document.getElementById('val-score'), energy: document.getElementById('val-energy'),
            energyFill: document.getElementById('energy-fill'), flash: document.getElementById('flash-screen'),
            speed: document.getElementById('val-speed'), combo: document.getElementById('combo-tag')
        };

        let isDragging = false;
        function updatePlayerPos(clientX) {
            if (!state.active) return;
            const stageRect = el.stage.getBoundingClientRect();
            state.playerX = Math.max(15, Math.min(85, ((clientX - stageRect.left) / stageRect.width) * 100));
            el.player.style.left = state.playerX + '%';
        }

        el.stage.addEventListener('mousedown', (e) => { isDragging = true; updatePlayerPos(e.clientX); });
        window.addEventListener('mousemove', (e) => { if (isDragging) updatePlayerPos(e.clientX); });
        window.addEventListener('mouseup', () => { isDragging = false; });
        el.stage.addEventListener('touchstart', (e) => { isDragging = true; updatePlayerPos(e.touches[0].clientX); }, { passive: false });
        el.stage.addEventListener('touchmove', (e) => { if (isDragging) { e.preventDefault(); updatePlayerPos(e.touches[0].clientX); } }, { passive: false });
        el.stage.addEventListener('touchend', () => { isDragging = false; });

        function startGame() {
            document.getElementById('start-overlay').style.display = 'none';
            state.active = true;
            if (AudioEngine.soundOn) {
                AudioEngine.init(); AudioEngine.startEngine();
                AudioEngine.musicTimer = setInterval(() => AudioEngine.playMusicStep(), 200);
            }
            gameLoop(); spawnLoop(); sceneryLoop(); cloudLoop();
        }

        function gameLoop() {
            if (!state.active) return;
            state.distance++;
            state.energy -= 0.04;
            state.speedMult = 1 + (state.distance / 5000);
            AudioEngine.updateEngine(state.speedMult);
            updateEnvironment(); updateUI();
            requestAnimationFrame(gameLoop);
        }

        function updateEnvironment() {
            // –°–º–µ–Ω–∞ –±–∏–æ–º–æ–≤ –∫–∞–∂–¥—ã–µ 2000–º
            const worldStep = Math.floor(state.distance / 2000) % 3;
            const biomes = ['forest', 'desert', 'cyber'];
            state.biome = biomes[worldStep];

            const colors = {
                forest: ['#7ad8d0', '#6ebfb7'], // –ì–æ–ª—É–±–æ–π –∏ –±–∏—Ä—é–∑–∞
                desert: ['#f39c12', '#e67e22'], // –û—Ä–∞–Ω–∂–µ–≤—ã–π
                cyber: ['#2c3e50', '#1c2833']   // –¢–µ–º–Ω—ã–π
            };
            el.stage.style.background = colors[state.biome][0];
            document.documentElement.style.setProperty('--sky', colors[state.biome][0]);
            document.documentElement.style.setProperty('--road', state.biome === 'cyber' ? '#34495e' : '#95a5a6');
        }

        function updateUI() {
            el.score.textContent = Math.floor(state.score);
            el.energy.textContent = Math.ceil(state.energy);
            el.speed.textContent = state.speedMult.toFixed(1);
            el.energyFill.style.width = state.energy + '%';
            el.energyFill.style.background = state.energy < 30 ? '#e74c3c' : '#2ecc71';

            if (state.shield) el.player.classList.add('shielded'); else el.player.classList.remove('shielded');
            if (state.combo >= 10) el.player.classList.add('fever'); else el.player.classList.remove('fever');

            if (state.combo > 2) {
                el.combo.style.display = 'block';
                el.combo.textContent = `COMBO x${state.combo}! ${state.combo >= 10 ? 'üî•FEVER!üî•' : ''}`;
            } else el.combo.style.display = 'none';
        }

        function spawnLoop() {
            if (!state.active) return;
            const roll = Math.random();
            if (roll < 0.45) createObj('‚≠ê');
            else if (roll < 0.65) createObj('üç≠');
            else if (roll < 0.85) createObj('üöß');
            else if (roll < 0.92) createObj('üöì');
            else if (roll < 0.96) createObj('üõ°Ô∏è');
            else createObj('üß≤');
            setTimeout(spawnLoop, Math.max(200, 1000 / state.speedMult));
        }

        function sceneryLoop() {
            if (!state.active) return;
            createScenery();
            setTimeout(sceneryLoop, Math.max(300, 1500 / state.speedMult));
        }

        function cloudLoop() {
            if (!state.active) return;
            createCloud();
            setTimeout(cloudLoop, 3000 + Math.random() * 5000);
        }

        function createParticles(x, y, color) {
            for (let i = 0; i < 12; i++) {
                const p = document.createElement('div');
                p.className = 'particle';
                p.style.left = x + '%';
                p.style.top = y + 'px';
                p.style.background = color;
                el.stage.appendChild(p);

                const angle = Math.random() * Math.PI * 2;
                const speed = 2 + Math.random() * 5;
                let vx = Math.cos(angle) * speed;
                let vy = Math.sin(angle) * speed;
                let life = 1;

                const moveP = () => {
                    life -= 0.02;
                    if (life <= 0) { p.remove(); return; }
                    p.style.left = (parseFloat(p.style.left) + vx * 0.1) + '%';
                    p.style.top = (parseFloat(p.style.top) + vy) + 'px';
                    p.style.opacity = life;
                    requestAnimationFrame(moveP);
                };
                requestAnimationFrame(moveP);
            }
        }

        function createScenery() {
            const side = Math.random() < 0.5 ? 'left' : 'right';
            const s = document.createElement('div');
            s.className = 'scenery';
            const items = { forest: ['üå≤', 'üå≥', 'üå∏'], desert: ['üåµ', 'üèúÔ∏è', 'ü™®'], cyber: ['üèôÔ∏è', 'üóº', 'üö•'] };
            s.innerHTML = items[state.biome][Math.floor(Math.random() * 3)];
            s.style.left = side === 'left' ? (Math.random() * 8) + '%' : (92 + Math.random() * 8) + '%';
            s.style.top = '-100px';
            el.stage.appendChild(s);

            let top = -100;
            const moveS = () => {
                if (!state.active) { s.remove(); return; }
                top += 6 * state.speedMult;
                s.style.top = top + 'px';
                if (top < window.innerHeight + 100) requestAnimationFrame(moveS); else s.remove();
            };
            requestAnimationFrame(moveS);
        }

        function createCloud() {
            const c = document.createElement('div');
            c.className = 'cloud';
            c.innerHTML = '‚òÅÔ∏è';
            c.style.left = '-150px';
            c.style.top = (Math.random() * 40) + '%';
            el.stage.appendChild(c);
            let left = -150;
            const moveC = () => {
                if (!state.active) { c.remove(); return; }
                left += (1 + Math.random());
                c.style.left = left + 'px';
                if (left < window.innerWidth + 150) requestAnimationFrame(moveC); else c.remove();
            };
            requestAnimationFrame(moveC);
        }

        function createObj(type) {
            const obj = document.createElement('div');
            obj.className = 'game-object' + (type === 'üöì' ? ' police' : '');
            obj.innerHTML = type;
            const startX = 15 + Math.random() * 70;
            obj.style.left = startX + '%';
            obj.style.top = '-100px';
            el.stage.appendChild(obj);
            let top = -100;
            const speed = (type === 'üöì' ? 12 : 6) * state.speedMult;
            const moveObj = () => {
                if (!state.active) { obj.remove(); return; }
                if (state.magnet > 0 && (type === '‚≠ê' || type === 'üç≠')) {
                    const lPos = parseFloat(obj.style.left);
                    obj.style.left = (lPos + (state.playerX - lPos) * 0.15) + '%';
                }
                top += speed; obj.style.top = top + 'px';
                if (top > window.innerHeight * 0.7 && top < window.innerHeight * 0.88) {
                    if (Math.abs(parseFloat(obj.style.left) - state.playerX) < 12) { collect(type, parseFloat(obj.style.left)); obj.remove(); return; }
                }
                if (top < window.innerHeight + 100) requestAnimationFrame(moveObj);
                else { if (type === '‚≠ê') state.combo = 0; obj.remove(); }
            };
            requestAnimationFrame(moveObj);
        }

        function collect(type, xPos) {
            const yPos = window.innerHeight * 0.8;
            if (type === '‚≠ê') {
                state.combo++;
                state.score += 10 * Math.min(5, state.combo) * (state.combo >= 10 ? 2 : 1);
                AudioEngine.playSFX(600 + (state.combo * 50), 'sine', 0.1, 800);
                createParticles(xPos, yPos, '#f1c40f');
                flashEffect('#ffdf6b');
            } else if (type === 'üç≠') {
                state.energy = Math.min(100, state.energy + 10);
                AudioEngine.playSFX(400, 'sine', 0.2, 600);
                createParticles(xPos, yPos, '#2ecc71');
                flashEffect('#2ecc71');
            } else if (type === 'üöß' || type === 'üöì') {
                if (state.shield) {
                    state.shield = false; AudioEngine.playSFX(200, 'square', 0.3, 50);
                    createParticles(xPos, yPos, '#3498db');
                } else {
                    state.energy -= 25; state.combo = 0;
                    document.body.classList.add('shake'); setTimeout(() => document.body.classList.remove('shake'), 500);
                    AudioEngine.playCrash(); createParticles(xPos, yPos, '#e74c3c');
                    flashEffect('#e74c3c');
                }
            } else if (type === 'üõ°Ô∏è') {
                state.shield = true; AudioEngine.playSFX(300, 'sawtooth', 0.4, 600);
                createParticles(xPos, yPos, '#3498db');
            } else if (type === 'üß≤') {
                state.magnet = 500; AudioEngine.playSFX(200, 'sine', 0.5, 1000);
                createParticles(xPos, yPos, '#9b59b6');
                const magTimer = setInterval(() => { state.magnet--; if (state.magnet <= 0) clearInterval(magTimer); }, 20);
            }
        }

        function flashEffect(color) {
            el.flash.style.background = color; el.flash.style.opacity = '0.3';
            setTimeout(() => el.flash.style.opacity = '0', 100);
        }

        function endGame() {
            state.active = false; AudioEngine.stopEngine(); clearInterval(AudioEngine.musicTimer);
            document.body.innerHTML = `
                <div class="overlay" style="background: #ff4757">
                    <h1 style="color:white; font-size:3rem;">–¢–£–† –û–ö–û–ù–ß–ï–ù! üèÅ</h1>
                    <div style="font-size: 5rem;">üèÜ</div>
                    <h2 style="color:white">–¢–≤–æ–π —Å—á—ë—Ç: ${Math.floor(state.score)}</h2>
                    <p style="color:white; font-size:1.2rem;">–î–∏—Å—Ç–∞–Ω—Ü–∏—è: ${Math.floor(state.distance)}–º</p>
                    <button class="btn-big" onclick="location.reload()">–ù–û–í–´–ô –¢–£–†! üöÄ</button>
                </div>
            `;
            if (AudioEngine.soundOn) AudioEngine.playSFX(100, 'sawtooth', 1, 50);
        }
    </script>
</body>

</html>